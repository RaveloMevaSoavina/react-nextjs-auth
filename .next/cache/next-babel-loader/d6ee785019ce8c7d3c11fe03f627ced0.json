{"ast":null,"code":"import { query as q } from 'faunadb';\nimport cookie from 'cookie';\nimport { faunaClient, FAUNA_SECRET_COOKIE } from '../../utils/fauna-auth';\nexport default (async (req, res) => {\n  var _req$headers$cookie;\n\n  const cookies = cookie.parse((_req$headers$cookie = req.headers.cookie) !== null && _req$headers$cookie !== void 0 ? _req$headers$cookie : '');\n  const faunaSecret = cookies[FAUNA_SECRET_COOKIE];\n\n  if (!faunaSecret) {\n    // Already logged out.\n    return res.status(200).end();\n  } // Invalidate secret (ie. logout from Fauna).\n\n\n  await faunaClient(faunaSecret).query(q.Logout(false)); // Clear cookie.\n\n  const cookieSerialized = cookie.serialize(FAUNA_SECRET_COOKIE, '', {\n    sameSite: 'lax',\n    secure: false,\n    maxAge: -1,\n    httpOnly: true,\n    path: '/'\n  });\n  res.setHeader('Set-Cookie', cookieSerialized);\n  res.status(200).end();\n});","map":{"version":3,"sources":["/Users/Nick/Documents/ServeVue/react-auth/with-cookie-auth-fauna/pages/api/logout.js"],"names":["query","q","cookie","faunaClient","FAUNA_SECRET_COOKIE","req","res","cookies","parse","headers","faunaSecret","status","end","Logout","cookieSerialized","serialize","sameSite","secure","maxAge","httpOnly","path","setHeader"],"mappings":"AAAA,SAASA,KAAK,IAAIC,CAAlB,QAA2B,SAA3B;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,SAASC,WAAT,EAAsBC,mBAAtB,QAAiD,wBAAjD;AAEA,gBAAe,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAAA;;AACjC,QAAMC,OAAO,GAAGL,MAAM,CAACM,KAAP,wBAAaH,GAAG,CAACI,OAAJ,CAAYP,MAAzB,qEAAmC,EAAnC,CAAhB;AACA,QAAMQ,WAAW,GAAGH,OAAO,CAACH,mBAAD,CAA3B;;AACA,MAAI,CAACM,WAAL,EAAkB;AAChB;AACA,WAAOJ,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,GAAhB,EAAP;AACD,GANgC,CAOjC;;;AACA,QAAMT,WAAW,CAACO,WAAD,CAAX,CAAyBV,KAAzB,CAA+BC,CAAC,CAACY,MAAF,CAAS,KAAT,CAA/B,CAAN,CARiC,CASjC;;AACA,QAAMC,gBAAgB,GAAGZ,MAAM,CAACa,SAAP,CAAiBX,mBAAjB,EAAsC,EAAtC,EAA0C;AACjEY,IAAAA,QAAQ,EAAE,KADuD;AAEjEC,IAAAA,MAAM,OAF2D;AAGjEC,IAAAA,MAAM,EAAE,CAAC,CAHwD;AAIjEC,IAAAA,QAAQ,EAAE,IAJuD;AAKjEC,IAAAA,IAAI,EAAE;AAL2D,GAA1C,CAAzB;AAOAd,EAAAA,GAAG,CAACe,SAAJ,CAAc,YAAd,EAA4BP,gBAA5B;AACAR,EAAAA,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,GAAhB;AACD,CAnBD","sourcesContent":["import { query as q } from 'faunadb'\nimport cookie from 'cookie'\nimport { faunaClient, FAUNA_SECRET_COOKIE } from '../../utils/fauna-auth'\n\nexport default async (req, res) => {\n  const cookies = cookie.parse(req.headers.cookie ?? '')\n  const faunaSecret = cookies[FAUNA_SECRET_COOKIE]\n  if (!faunaSecret) {\n    // Already logged out.\n    return res.status(200).end()\n  }\n  // Invalidate secret (ie. logout from Fauna).\n  await faunaClient(faunaSecret).query(q.Logout(false))\n  // Clear cookie.\n  const cookieSerialized = cookie.serialize(FAUNA_SECRET_COOKIE, '', {\n    sameSite: 'lax',\n    secure: process.env.NODE_ENV === 'production',\n    maxAge: -1,\n    httpOnly: true,\n    path: '/',\n  })\n  res.setHeader('Set-Cookie', cookieSerialized)\n  res.status(200).end()\n}\n"]},"metadata":{},"sourceType":"module"}