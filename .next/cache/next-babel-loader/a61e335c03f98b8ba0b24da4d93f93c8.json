{"ast":null,"code":"import { query as q } from 'faunadb';\nimport { serverClient, serializeFaunaCookie } from '../../utils/fauna-auth';\nexport default (async (req, res) => {\n  const {\n    username,\n    password\n  } = await req.body;\n\n  try {\n    if (!username || !password) {\n      throw new Error('Username and password must be provided.');\n    }\n\n    const response = await fetch('http://localhost:8080/api/signin', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        username,\n        password\n      })\n    });\n    const json = await response.json();\n    console.log({\n      json\n    });\n    const loginRes = await serverClient.query(q.Login(q.Match(q.Index('users_by_email'), username), {\n      password\n    }));\n    console.log({\n      json\n    }); // if (!loginRes.secret) {\n    //   throw new Error('No secret present in login query response.')\n    // }\n    // const cookieSerialized = serializeFaunaCookie(loginRes.secret)\n    // res.setHeader('Set-Cookie', cookieSerialized)\n    // res.status(200).end()\n  } catch (error) {\n    res.status(400).send(error.message);\n  }\n});","map":{"version":3,"sources":["/Users/Nick/Documents/ServeVue/react-auth/with-cookie-auth-fauna/pages/api/login.js"],"names":["query","q","serverClient","serializeFaunaCookie","req","res","username","password","body","Error","response","fetch","method","headers","JSON","stringify","json","console","log","loginRes","Login","Match","Index","error","status","send","message"],"mappings":"AAAA,SAASA,KAAK,IAAIC,CAAlB,QAA2B,SAA3B;AACA,SAASC,YAAT,EAAuBC,oBAAvB,QAAmD,wBAAnD;AAEA,gBAAe,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AACjC,QAAM;AAAEC,IAAAA,QAAF;AAAYC,IAAAA;AAAZ,MAAyB,MAAMH,GAAG,CAACI,IAAzC;;AAEA,MAAI;AACF,QAAI,CAACF,QAAD,IAAa,CAACC,QAAlB,EAA4B;AAC1B,YAAM,IAAIE,KAAJ,CAAU,yCAAV,CAAN;AACD;;AAED,UAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,kCAAD,EAAqC;AAC/DC,MAAAA,MAAM,EAAE,MADuD;AAE/DC,MAAAA,OAAO,EAAE;AAAE,wBAAgB;AAAlB,OAFsD;AAG/DL,MAAAA,IAAI,EAAEM,IAAI,CAACC,SAAL,CAAe;AAAET,QAAAA,QAAF;AAAYC,QAAAA;AAAZ,OAAf;AAHyD,KAArC,CAA5B;AAMA,UAAMS,IAAI,GAAG,MAAMN,QAAQ,CAACM,IAAT,EAAnB;AAEAC,IAAAA,OAAO,CAACC,GAAR,CAAY;AAACF,MAAAA;AAAD,KAAZ;AAEA,UAAMG,QAAQ,GAAG,MAAMjB,YAAY,CAACF,KAAb,CACrBC,CAAC,CAACmB,KAAF,CAAQnB,CAAC,CAACoB,KAAF,CAAQpB,CAAC,CAACqB,KAAF,CAAQ,gBAAR,CAAR,EAAmChB,QAAnC,CAAR,EAAsD;AACpDC,MAAAA;AADoD,KAAtD,CADqB,CAAvB;AAMAU,IAAAA,OAAO,CAACC,GAAR,CAAY;AAACF,MAAAA;AAAD,KAAZ,EArBE,CAuBF;AACA;AACA;AAEA;AAEA;AACA;AACD,GA/BD,CA+BE,OAAOO,KAAP,EAAc;AACdlB,IAAAA,GAAG,CAACmB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,KAAK,CAACG,OAA3B;AACD;AACF,CArCD","sourcesContent":["import { query as q } from 'faunadb'\nimport { serverClient, serializeFaunaCookie } from '../../utils/fauna-auth'\n\nexport default async (req, res) => {\n  const { username, password } = await req.body\n\n  try {\n    if (!username || !password) {\n      throw new Error('Username and password must be provided.')\n    }\n\n    const response = await fetch('http://localhost:8080/api/signin', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ username, password }),\n    })\n\n    const json = await response.json();\n\n    console.log({json})\n\n    const loginRes = await serverClient.query(\n      q.Login(q.Match(q.Index('users_by_email'), username), {\n        password,\n      })\n    )\n\n    console.log({json})\n\n    // if (!loginRes.secret) {\n    //   throw new Error('No secret present in login query response.')\n    // }\n\n    // const cookieSerialized = serializeFaunaCookie(loginRes.secret)\n\n    // res.setHeader('Set-Cookie', cookieSerialized)\n    // res.status(200).end()\n  } catch (error) {\n    res.status(400).send(error.message)\n  }\n}\n"]},"metadata":{},"sourceType":"module"}