{"ast":null,"code":"import { query as q } from 'faunadb';\nimport cookie from 'cookie';\nimport { faunaClient, FAUNA_SECRET_COOKIE } from '../../utils/fauna-auth';\nexport const profileApi = async faunaSecret => {\n  const ref = await faunaClient(faunaSecret).query(q.Identity());\n  return ref.id;\n};\nexport default (async (req, res) => {\n  var _req$headers$cookie;\n\n  const cookies = cookie.parse((_req$headers$cookie = req.headers.cookie) !== null && _req$headers$cookie !== void 0 ? _req$headers$cookie : '');\n  const faunaSecret = cookies[FAUNA_SECRET_COOKIE];\n\n  if (!faunaSecret) {\n    return res.status(401).send('Auth cookie missing.');\n  }\n\n  res.status(200).json({\n    userId: await profileApi(faunaSecret)\n  });\n});","map":{"version":3,"sources":["/Users/Nick/Documents/ServeVue/react-auth/with-cookie-auth-fauna/pages/api/profile.js"],"names":["query","q","cookie","faunaClient","FAUNA_SECRET_COOKIE","profileApi","faunaSecret","ref","Identity","id","req","res","cookies","parse","headers","status","send","json","userId"],"mappings":"AAAA,SAASA,KAAK,IAAIC,CAAlB,QAA2B,SAA3B;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,SAASC,WAAT,EAAsBC,mBAAtB,QAAiD,wBAAjD;AAEA,OAAO,MAAMC,UAAU,GAAG,MAAMC,WAAN,IAAqB;AAC7C,QAAMC,GAAG,GAAG,MAAMJ,WAAW,CAACG,WAAD,CAAX,CAAyBN,KAAzB,CAA+BC,CAAC,CAACO,QAAF,EAA/B,CAAlB;AACA,SAAOD,GAAG,CAACE,EAAX;AACD,CAHM;AAKP,gBAAe,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAAA;;AACjC,QAAMC,OAAO,GAAGV,MAAM,CAACW,KAAP,wBAAaH,GAAG,CAACI,OAAJ,CAAYZ,MAAzB,qEAAmC,EAAnC,CAAhB;AACA,QAAMI,WAAW,GAAGM,OAAO,CAACR,mBAAD,CAA3B;;AAEA,MAAI,CAACE,WAAL,EAAkB;AAChB,WAAOK,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,sBAArB,CAAP;AACD;;AAEDL,EAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBE,IAAhB,CAAqB;AAAEC,IAAAA,MAAM,EAAE,MAAMb,UAAU,CAACC,WAAD;AAA1B,GAArB;AACD,CATD","sourcesContent":["import { query as q } from 'faunadb'\nimport cookie from 'cookie'\nimport { faunaClient, FAUNA_SECRET_COOKIE } from '../../utils/fauna-auth'\n\nexport const profileApi = async faunaSecret => {\n  const ref = await faunaClient(faunaSecret).query(q.Identity())\n  return ref.id\n}\n\nexport default async (req, res) => {\n  const cookies = cookie.parse(req.headers.cookie ?? '')\n  const faunaSecret = cookies[FAUNA_SECRET_COOKIE]\n\n  if (!faunaSecret) {\n    return res.status(401).send('Auth cookie missing.')\n  }\n\n  res.status(200).json({ userId: await profileApi(faunaSecret) })\n}\n"]},"metadata":{},"sourceType":"module"}